# 🚀 快速参考 - 动态止损

## 启用/禁用

```yaml
# ✅ 启用 - 从最高价下跌 5% 时止损
trailing_stop_loss: 0.05

# ❌ 禁用
trailing_stop_loss: 0.0
```

## 工作原理

```
买入价: $100
    ↓ 上升 ↓
最高价: $110  ← 自动记录
    ↓ 下跌 ↓
触发价: $110 × 0.95 = $104.50
当前价: $103  ← 低于触发价
    ↓
🛑 自动卖出 (保护 +3% 利润)
```

## 日志输出

```
✓ 平仓决策[动态止损]: AAPL 100股 @$103.00
(最高$110.00, 触发阈值$104.50, 从高点下跌6.36%)
```

## 常见场景

| 场景 | 买入 | 最高 | 当前 | 触发? | 原因 |
|------|------|------|------|-------|------|
| 获利中回调 | $100 | $110 | $105 | ❌ | $105 > $104.50 |
| 获利中大跌 | $100 | $110 | $104 | ✅ | $104 < $104.50 |
| 一直亏损 | $100 | $100 | $95 | ✅ | $95 < $95 |
| 盈利中涨 | $100 | $110 | $115 | ❌ | 最高价更新 |

## 与其他止损对比

```
动态止损 vs 固定止损

场景: 买入 $100，涨到 $110，跌到 $95

固定止损 (-8%):
  触发价 = $100 × 0.92 = $92
  $95 > $92 → 不触发

动态止损 (-5%):
  触发价 = $110 × 0.95 = $104.50
  $95 < $104.50 → 触发! ✅
  
结论: 动态止损更快锁定利润
```

## 调试技巧

```bash
# 查看所有动态止损触发
grep "动态止损" backtest_v8.log

# 统计触发次数
grep -c "动态止损" backtest_v8.log

# 对比两个版本
diff <(grep "平仓决策" backtest_v8_old.log) \
     <(grep "平仓决策" backtest_v8_new.log)
```

## 预期效果

| 幅度 | 特点 | 适用 |
|------|------|------|
| 0.03 (3%) | 激进，提前止损 | 高波动股票 |
| 0.05 (5%) | 平衡（推荐） | 一般情况 |
| 0.08 (8%) | 保守，晚止损 | 趋势股票 |

